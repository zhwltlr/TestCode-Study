단위 테스트는 단순히 테스트를 작성하는 것보다 더 큰 범주다.
단위테스트에 시간을 투자할 때는 항상 최대한 이득을 얻도록 노력해야 하며, 테스트에 드는 노력을 가능한 한 줄이고 그에 따르는 이득을 최대화해야 한다.

---

### 단위 테스트 현황

- 기업용 애플리케이션 개발 프로젝트는 거의 모두 단위 테스트가 적용돼 있다.
- 제품 코드와 테스트 코드의 비율은 1:1에서 1:3(제품 코드 한 줄 : 테스트 코드 세 줄) 정도
- 소프트웨어 프로젝트에서의 혼란
  - 새로운 기능을 구현하는데 오래 걸리고, 이미 구현되고 반영된 기능에 새로운 버그가 지속적으로 나타나며, 테스트가 상황을 더 나쁘게 할 수도 있다.

## 단위 테스트 목표

- 코드 베이스에 대해 단위 테스트 작성이 필요하면 일반적으로 더 나은 설계로 이어진다. 하지만 더 나은 설계는 단지 좋은 사이드 이펙트일 뿐 주목표는 아니다.
- **단위 테스트의 목표는 소프트웨어 프로젝트의 지속 가능한 성장을 가능하게 하는 것이다.**

  ![testdevelop](https://github.com/zhwltlr/TestCode-Study/assets/100506719/b49696d8-f056-42a5-83e7-2fe4b50e85d1)

- 테스트가 없는 프로젝트는 아직 잘못된 아키텍처 결정이 없고 걱정할 만한 코드도 없기 때문에 빨리 시작할 수 있다. 그러나 시간이 지나면서 점점 더 많은 시간을 들여야 처음에 보여준 것과 같은 정도의 진척을 낼 수 있다.

#### 소프트웨어 엔트로피 : 개발 속도가 빠르게 감소하는 현상

- 코드베이스에서 무언가를 변경할 때마다 무질서도는 증가
- 지속적인 리팩터링이 없으면 시스템이 점점 더 복잡해지고 무질서해진다.
- 최악의 경우 안정되게 복구하는 것이 어려워진다.

- 테스트로 이러한 경향을 뒤집을 수 있다.
- 테스트는 새로운 기능을 도입하거나 새로운 요구 사항에 더 잘 맞게 리팩터링한 후에도 기존 기능이 잘 작동하는지 확인하는데 도움이 된다.
- 코드베이스를 검증하는 테스트 없이는 소프트웨어 개발이 쉽게 확장되지 않는다.
- 지속성과 확장성이 핵심이며, 이를 통해 장기적으로 개발 속도를 유지할 수 있다.

### 좋은 테스트와 좋지 않은 테스트를 가르는 요인

- 잘못 작성한 테스트도 프로젝트가 침체 단계에 진입하는 데 시간이 더 걸리게 할 순 있지만, 피할 수는 없다.
  ![wrongtest](https://github.com/zhwltlr/TestCode-Study/assets/100506719/415779c4-4df1-4eb2-bd3a-5aad9c2d91d4)
- 잘못된 테스트는 오류를 알아내는 데 도움이 되지 않는다.
- 테스트의 가치와 유지 비용을 모두 고려해야 한다.
  - 비용요소 : 다양한 활동에 필요한 시간에 따라 결정
    - 기반 코드를 리팩터링할 때 테스트도 리택터링
    - 각 코드 변경 시 테스트를 실행
    - 테스트가 잘못된 경고를 발생시킬 경우 처리
    - 기반 코드가 어떻게 동작하는지 이해하려고 할 때는 테스트를 읽는데 시간 투자

## 테스트 스위트 품질 측정을 위한 커버리지 지표

- 커버리지 지표는 테스트 스위트가 소스코드를 얼마나 실행하는지를 백분율로 나타낸다.
- 일반적으로 커버리지 숫자가 높을수록 테스트 스위트의 품질을 높게 평가한다.

### 코드 커버리지(테스트 커버리지)

이 지표는 하나 이상의 테스트로 실행된 코드 라인 수와 제품 코드베이스의 전체 라인 수의 비율을 나타낸다.

```
public static bool IsstringLong (string input)
{
  if (input.Lenght > 5)
    return true;
  return false
}
```

`true` 반환 구문 제외하고 테스트를 실행했으므로 테스트 라인 수(4) / 메서드 전체 라인 수(5) = 0.8 = 80%

```
public static bool IsstringLong (string input)
{
  return input.Lenght > 5
}
```

이때 테스트는 모든 라인(3)을 점검하기 때문에 코드 커버리지가 100%로 증가했다.
**리팩터링으로 테스트 스위트를 개선한 것이 아님에도 코드 커버리지가 증가할 수 있는 맹점**

### 분기 커버리지 지표에 대한 이해 (branch coverage)

- 코드 커버리지의 단점을 극복하고 더 정확한 결과를 제공한다.
- 원시 코드 라인 수를 사용하는 대신 if문과 switch 문과 같은 제어 구조에 중점을 둔다.
- 테스트 스위트 내 하나 이상의 테스트가 통과하는 제어 구조의 수를 나타낸다.

  <img src="https://github.com/zhwltlr/TestCode-Study/assets/100506719/9002e382-671e-4441-9fe5-173097f7a6de"  width="350" />

- 코드베이스에서 모든 가능한 분기를 합산하고 그중 테스트가 얼마나 많이 실행되는지 확인해야 한다.

  ```
  public static bool IsstringLong (string input)
  {
    return input.Lenght > 5
  }
  ```

- 경우의 수는 문자열 인수의 길이가 다섯 자를 초과하는 상황과 그렇지 않은 경우
- 이때 분기 커버리지 지표는 1/2 = 0.5 = 50%
- 즉, 해당 분기를 구현하는 데 얼마나 코드가 필요한지 고려하지 않고 분기 개수만을 다룬다.

#### 커버리지 지표의 문제점

- 테스트 대상 시스템의 모든 가능한 결과를 검증한다고 할 수 없다.

  ```
  public static bool WasLastStringLong { get; private set; }

  public static bool IsstringLong (string input)
  {
    bool result = input.Lenght > 5
    WasLastStringLong = result;
    return result;
  }
  ```

  - 속성에 새로운 값을 쓰는 암묵적인 결과를 검증하지 않아도 100% 코드 커버리지와 50% 분기 커버리지의 동일한 결과를 나타낸다.

- 외부 라이브러리의 코드 경로를 고려할 수 있는 커버리지 지표는 없다.

  ```
  public static int Parse(string input);
  ```

  - .NET 프레임워크의 int.Parse 메서드가 수행하는 코드 경로는 고려하지 않는다.
    ![intParse](https://github.com/zhwltlr/TestCode-Study/assets/100506719/1cf799cd-df99-4063-bbe5-ff35660c78be)

- 이처럼 수많은 예외상황에 빠질 수 있지만, 테스트는 이를 모두 검증하지 못한다.

**_시스템의 핵심 부분은 커버리지를 높게 두는 것이 좋다. 하지만 이를 높은 수준의 요구사항으로 두는 것은 좋지 않다._**

### 성공적인 테스트 스위트

- 개발주기에 통합돼 있다.

  - 자동화된 테스트를 할 수 있는 방법은 끊임없이 하는 것뿐이다. 이상적으로는 코드가 변경될 때마다 아무리 작은 것이라도 실행해야 한다.

- 코드베이스에서 가장 중요한 부분만을 대상으로 한다.

  - 단위테스트 측면에서 코드베이스의 모든 부분에 주목할 필요는 없다.
  - 시스템의 가장 중요한 부분에 단위 테스트를 기울이고, 다른 부분은 간략하게 혹은 간접적으로 검증하는 것이 좋다.
  - 대부분의 어플리케이션에서 가장 중요한 부분은 비즈니스 로직이다.
  - 다른 모든 부분은 세가지 범주로 나눌 수 있다.
    - 인프라 코드 / 데이터베이스나 서드파티 시스템과 같은 외부 서비스 및 종속성 / 모든 것을 하나로 묶는 코드

- 최소한의 유지비로 최대의 가치를 끌어낸다.
  - 테스트를 빌드 시스템에 통합하는 것만으로는 충분하지 않으며, 도메인 모델에 높은 테스트 커버리지를 유지하는 것도 충분하지 않다.
  - 가치가 유지비를 상회하는 테스트만 유지하는 것이 중요하다.
    - 가치 있는 테스트 식별하기 & 가치 있는 테스트 작성하기
  - 테스트 스위트 내에 가치 있는 테스트만 남기고 나머지는 모두 제거해야한다.
    - **애플리케이션과 테스트 코드는 모두 자산이 아니라 부채다.**

### 단위 테스트 목표를 달성하기 위한 유일한 방법

- **좋은 테스트와 좋지 않은 테스트를 구별하는 방법을 배운다.**

- **테스트를 리팩터링해서 더 가치 있게 만든다.**

---

<br />
<br />

**테스트 스위트**는 서로 다른 테스트 시나리오로 단일 작업을 실행하기 위한 논리적 그룹화 또는 테스트 케이스 모음

예를 들어, 제품 구매를 위한 테스트 스위트에는 다음과 같은 여러 테스트 케이스가 있다.

- 테스트 사례 1: 로그인
- 테스트 사례 2: 제품 추가
- 테스트 사례 3: 체크아웃
- 테스트 사례 4: 로그아웃

테스트 스위트는 테스트 케이스 의 컨테이너 역할도 합니다. 테스트에 필요한 다양한 테스트 사례 및 시스템 구성에 대한 자세한 정보와 목표가 포함된 검증 제품군
